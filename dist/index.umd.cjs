(function(u,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(u=typeof globalThis<"u"?globalThis:u||self,m(u.PrettyHttpClient={}))})(this,function(u){"use strict";const m=e=>{var c,h,f,y;const r=i=>(l,d)=>T(t,{...d,url:l,method:i}),t={prefix:(e==null?void 0:e.prefix)??"",alias:(e==null?void 0:e.alias)??"",headers:{...e==null?void 0:e.headers},hooks:{beforeRequest:((c=e==null?void 0:e.hooks)==null?void 0:c.beforeRequest)||[],afterResponse:((h=e==null?void 0:e.hooks)==null?void 0:h.afterResponse)||[],beforeRetry:((f=e==null?void 0:e.hooks)==null?void 0:f.beforeRetry)||[],catchError:((y=e==null?void 0:e.hooks)==null?void 0:y.catchError)||[]},retryCount:(e==null?void 0:e.retryCount)??0,retryTimeout:(e==null?void 0:e.retryTimeout)??0,cache:new S((e==null?void 0:e.cacheSize)??1e4),get:r("GET"),post:r("POST"),put:r("PUT"),delete:r("DELETE"),patch:r("PATCH"),head:r("HEAD")};return t},T=async(e,r)=>{var E,P;const t=Object.assign(r,{headers:{...e.headers,...r.headers},searchParams:r.searchParams||{},data:r.data||null}),c=r.retryCount??e.retryCount;for(const a of e.hooks.beforeRequest??[])await a(e,t);const h=e.prefix+t.url,f=Object.fromEntries(Object.entries(t.searchParams).filter(([a,s])=>s!=null)),y=new URLSearchParams(f).toString(),i=y?`${h}?${y}`:h;let l;t.method!=="GET"&&t.method!=="HEAD"&&(t.data instanceof FormData?l=t.data:typeof t.data=="object"&&t.data!==null?l=JSON.stringify(t.data):l=t.data);let d;const w=((E=r.cache)==null?void 0:E.milliseconds)??0,C=w>0;let n;if(C&&(n=(P=r.cache)==null?void 0:P.matcher(e,t),n)){const a=e.cache.get(n);a&&(await b(0),d=a.clone())}try{d===void 0&&(d=await fetch(i,{method:t.method,body:l,headers:t.headers}),C&&n&&e.cache.set(n,d.clone(),w));let a=d;for(const s of e.hooks.afterResponse){const R=await s(e,t,a);R!==void 0&&(a=R)}return a}catch(a){if(c>0){for(const s of e.hooks.beforeRetry)s(e,r);return await b(e.retryTimeout),T(e,{...r,retryCount:c-1})}for(const s of e.hooks.catchError)s(a);throw a}},b=(e=0)=>new Promise(r=>setTimeout(()=>r(),e));class S{constructor(r){this.cache=new Map,this.maxSize=r}set(r,t,c){this.cache.has(r)&&this.delete(r);const h=Date.now()+c;if(this.cache.set(r,{value:t,expirationTime:h}),this.size>this.maxSize){const f=this.cache.keys().next().value;f&&this.delete(f)}}get(r){const t=this.cache.get(r);if(!t)return null;const{value:c,expirationTime:h}=t;return Date.now()>h?(this.delete(r),null):(this.delete(r),this.cache.set(r,t),c)}get size(){return this.cache.size}clear(){this.cache.clear()}delete(r){return this.cache.delete(r)}}u.createHttpClient=m,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
